/*! kidstagram 08-12-2015 */
function populateUserTable(){var a="";$.getJSON("/users/userlist",function(b){userListData=b,$.each(b,function(){a+="<tr>",a+='<td><a href="#" class="linkshowuser" rel="'+this.username+'">'+this.username+"</a></td>",a+="<td>"+this.email+"</td>",a+='<td><a href="#" class="linkdeleteuser" rel="'+this._id+'">delete</a></td>',a+="</tr>"}),$("#userList table tbody").html(a)})}function populateEventTable(){var a="";$.getJSON("/events/eventlist",function(b){eventListData=b,console.log(b),$.each(b,function(){a+="<tr>",a+='<td><a href="#" class="linkshowuser" rel="'+this.eventName+'">'+this.eventName+"</a></td>",a+="<td>"+this.description+"</td>",a+='<td><a href="#" class="linkdeleteevent" rel="'+this._id+'">delete</a></td>',a+="</tr>"}),$("#eventList tbody").html(a)})}function showUserInfo(a){a.preventDefault();var b=$(this).attr("rel"),c=userListData.map(function(a){return a.username}).indexOf(b),d=userListData[c];$("#userInfoName").text(d.fullname),$("#userInfoAge").text(d.age),$("#userInfoGender").text(d.gender),$("#userInfoLocation").text(d.location)}function addUser(a){a.preventDefault();var b=0;if($("#addUser input").each(function(a,c){""===$(this).val()&&b++}),0!==b)return alert("Please fill in all fields"),!1;var c={username:$("#addUser fieldset input#inputUserName").val(),email:$("#addUser fieldset input#inputUserEmail").val(),fullname:$("#addUser fieldset input#inputUserFullname").val(),age:$("#addUser fieldset input#inputUserAge").val(),location:$("#addUser fieldset input#inputUserLocation").val(),gender:$("#addUser fieldset input#inputUserGender").val()};$.ajax({type:"POST",data:c,url:"/users/adduser",dataType:"JSON"}).done(function(a){""===a.msg?($("#addUser fieldset input").val(""),populateUserTable()):alert("Error: "+a.msg)})}function deleteUser(a){a.preventDefault();var b=confirm("Are you sure you want to delete this user?");return b!==!0?!1:void $.ajax({type:"DELETE",url:"/users/deleteuser/"+$(this).attr("rel")}).done(function(a){""===a.msg||alert("Error: "+a.msg),populateUserTable()})}function showEventInfo(a){a.preventDefault();var b=$(this).attr("rel"),c=eventListData.map(function(a){return a.eventname}).indexOf(b),d=eventListData[c];$("#eventName").text(d.eventname),$("#eventDiscription").text(d.description)}function addEvent(a){a.preventDefault();var b=0;if($("#addEvent input").each(function(a,c){""===$(this).val()&&b++}),0!==b)return alert("Please fill in all fields"),!1;var c={eventName:$("#inputEventName").val(),description:$("#inputEventDescription").val()};$.ajax({type:"POST",data:c,url:"/events/addevent",dataType:"JSON"}).done(function(a){""===a.msg?($("#addEvent fieldset input").val(""),populateEventTable()):(console.log(a.msg),alert("Error: "+a.msg))})}function deleteEvent(a){a.preventDefault();var b=confirm("Are you sure you want to delete this event?");return b!==!0?!1:void $.ajax({type:"DELETE",url:"/events/deleteevent/"+$(this).attr("rel")}).done(function(a){""===a.msg||alert("Error: "+a.msg),populateEventTable()})}$(function(){$("#container").highcharts({chart:{type:"column"},title:{text:"Monthly Average Rainfall"},subtitle:{text:"Source: WorldClimate.com"},xAxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],crosshair:!0},yAxis:{min:0,title:{text:"Rainfall (mm)"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Tokyo",data:[49.9,71.5,106.4,129.2,144,176,135.6,148.5,216.4,194.1,95.6,54.4]},{name:"New York",data:[83.6,78.8,98.5,93.4,106,84.5,105,104.3,91.2,83.5,106.6,92.3]},{name:"London",data:[48.9,38.8,39.3,41.4,47,48.3,59,59.6,52.4,65.2,59.3,51.2]},{name:"Berlin",data:[42.4,33.2,34.5,39.7,52.6,75.5,57.4,60.4,47.6,39.1,46.8,51.1]}]})});var userListData=[],eventListData=[];$(window).load(function(){populateUserTable(),populateEventTable(),$("#userList table tbody").on("click","td a.linkshowuser",showUserInfo),$("#btnAddUser").on("click",addUser),$("#userList table tbody").on("click","td a.linkdeleteuser",deleteUser),$("#eventList table tbody").on("click","td a.linkshowevent",showEventInfo),$("#btnAddEvent").on("click",addEvent),$("#eventList tbody").on("click","td a.linkdeleteevent",deleteEvent)});var express=require("express"),router=express.Router();router.get("/eventlist",function(a,b){var c=a.db,d=c.get("eventlist");d.find({},{},function(a,c){b.json(c)})}),router.post("/addevent",function(a,b){var c=a.db,d=c.get("eventlist");d.insert(a.body,function(a,c){b.send(null===a?{msg:""}:{msg:a})})}),router["delete"]("/deleteevent/:id",function(a,b){var c=a.db,d=c.get("eventlist"),e=a.params.id;d.remove({_id:e},function(a){b.send(null===a?{msg:""}:{msg:"error: "+a})})}),module.exports=router;var express=require("express"),router=express.Router();router.get("/",function(a,b,c){b.sendFile("index.html")}),module.exports=router;var express=require("express"),router=express.Router();router.get("/userlist",function(a,b){var c=a.db,d=c.get("userlist");d.find({},{},function(a,c){b.json(c)})}),router.post("/adduser",function(a,b){var c=a.db,d=c.get("userlist");d.insert(a.body,function(a,c){b.send(null===a?{msg:""}:{msg:a})})}),router["delete"]("/deleteuser/:id",function(a,b){var c=a.db,d=c.get("userlist"),e=a.params.id;d.remove({_id:e},function(a){b.send(null===a?{msg:""}:{msg:"error: "+a})})}),module.exports=router;